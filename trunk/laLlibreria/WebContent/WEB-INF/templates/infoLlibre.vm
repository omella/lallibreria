#parse("WEB-INF/templates/header.vm")
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.js" type="text/javascript"></script> 
<script type="text/javascript" >

    function enviar(){
			var text = $("#comentariAjax").val();
            var dataString = 'text='+ text;
           	if(text=="" || text==" ") {
				$('#error').html("<div id='error'><font color='red' size='+1'><b>El comentari no pot ser buit!</b></font></div>");
			}
			else {
                $("#flash").show();
                $("#flash").fadeIn(400).html('<img src="http://feelsynapsis.com/mod/folder/graphics/spinner.gif" />Loading Comment...');
                $.ajax({
                    type: "POST",
                    url: "/laLlibreria/commentsAjax.action",
                    data: dataString,
                    cache: false,
                    success: function(html){
                        $("#comments").html(html);
                        $("#flash").hide();
                    }
                });
            }
			return false;
	};
	
	function enviarComandaAjax() {
		var num = $("#numAjax").val();
		if (num > 0) {
			var lib = $("#llibreriaAjax").val();
			$('#comandes').load('http://localhost:8080/laLlibreria/comandesAjax.action?num='+num+'&idLlibreria='+lib);
		}
	};

	function enviarAjax() {
			var text = $("#comentariAjax").val();
			if(text=="" || text==" ") {
				$('#error').html("<div id='error'><font color='red' size='+1'><b>El comentari no pot ser buit!</b></font></div>");
			}
			else {
				text = text.replace(/ /g,"+");
				$('#comments').load('http://localhost:8080/laLlibreria/commentsAjax.action?text='+text);
				$("#comentariAjax").val("");
				$('#error').html("<div id='error'></div>");
			}
	};
</script>
<body>
<div id=page>
<a href=/laLlibreria>Inici</a>
#if ($llibre)
	<div id=content>
		<div id=contentLlibre>
			<table>
				<tr>
					<td>	
						<div style="float: rigth;">
							<img src="http://covers.openlibrary.org/b/isbn/${llibre.isbn}-L.jpg" height=328 />
							## <img src="${llibre.cover}" height=328 />
						</div>
					</td>
					<td>
						<div style="float: rigth;">
							##<img src="http://covers.openlibrary.org/b/isbn/${llibre.isbn}-L.jpg" height=328 />
							<img src="${llibre.cover}" height=328 />
						</div>
					</td>
					<td>
						#if(${llibre.title})
							<h1> ${llibre.title} </h1>
						#end
						#if(${llibre.subtitle})
							<h2> ${llibre.subtitle} </h2>
						#end
						#if(${llibre.author})
							<h2> ${llibre.author} </h2>	
						#end
						#if(${llibre.year})
							<h3> Any: ${llibre.year}</h3>
						#end
						#if(${llibre.isbn})
							<h3> ISBN: ${llibre.isbn}</h3>	
						#end	
						#if(${llibre.publisher})
							Editorial: ${llibre.publisher}<br />
						#end	
						#if(${llibre.genre})
							Tematica: ${llibre.genre}<br />
						#end
						#if(${llibre.series})
							Series: ${llibre.series}<br />
						#end
						#if(${llibre.description})
							<b>Descripcio</b> <br />
							<i>"${llibre.description}"</i><br />
						#end
						#if(${llibre.language})
							Idioma: ${llibre.language}<br />
						#end
						#if(${llibre.preview})
							<script type="text/javascript">
							function newPopup(url) {
								popupWindow = window.open(
									url,'popUpWindow','height=700,width=800,left=10,top=10,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no,status=yes')
							}
							</script>
							<a href="JavaScript:newPopup('${llibre.preview}');">Preview</a>
						#end
					</td>
				</tr>
				</table>
			</div>
			<div id=contentPuntuacio>
				#parse( "WEB-INF/templates/puntuacioAjax.vm" )
			</div>
			#if(${llibre.similars})

				<div id=contentSimilars>
				<h2>Et recomanem els seguents llibres</h2>
				#foreach ($sim in ${llibre.similars})
					<div id="similars">
					<div id="similars_image">
					<img src="${sim.thumb}" />
					</div>
					<div id="similars_text">
					<a href=/laLlibreria/showBook.action?id=${sim.isbn}> ${sim.title}</a><br />
					${sim.author}
					</div>
					</div>
				#end
				</div>
			#end

			</div>
	</div>
	<div id=clear></div>
	<div id=leftContentLlibre>
		#if ($logged)
			Afegeix el teu comentari
			#sform ("action=addComentari")
				#stextarea ("name=text" "cols=40")
				#ssubmit ("value=Publicar")
			#end
			Afegeix el teu comentari amb Ajax <br />
			<div id="error"></div>
	        <textarea id="comentariAjax" cols="40"></textarea>
			<br />
			<button type="button" onclick="enviarAjax()">Publicar amb Ajax per GET</button>
			<button type="button" onclick="enviar()">Publicar amb Ajax per POST</button>
			<div id="flash"></div>
		#end
		<div id="comments">
			#parse( "WEB-INF/templates/commentsAjax.vm" )
		</div>
	</div>
	<div id=rightContentLlibre>
		<div id=contentOfertes>
			<h2>Ofertes</h2>
				#foreach ($oferta in ${ofertes})
					<div id="ofertes">
						<div id="ofertes_text">
						<h4>${oferta.llibreria}</h5>
						<br>
						<h1>${oferta.descompte}</h1>
						<br>
						<h1>${oferta.distancia}</h1>
						</div>
					</div>
				#end
				</div>
		<div id=comanda>
		#if ($logged.mail)
			<br/>
			Selecciona la quantitat i afegeix la comanda al teu carret
		    #sform ("action=addBookComanda")
				#stextfield ("label=Quantitat: " "name=num" "value=1")
				#sselect  ("list=llibreriesNoms" "name=idLlibreria")
				#ssubmit ("value=Afegir")
		    #end
		    Afegeix el llibre al carret de la comanda <br />
			<div id="error"></div>
			#stextfield ("label=Quantitat: " "name=numAjax" "value=1")
			<br>
			#sselect  ("list=llibreriesNoms" "name=llibreriaAjax" "label=Selecciona la llibreria: ")
			<br>
        	<button type="button" onclick="enviarComandaAjax()">Afegir</button>
			<br>
		    <div id=comandes>
				#parse( "WEB-INF/templates/comandaAjax.vm" )
			</div>
			Envia la teva comanda
			#sform ("action=enviarMail")
				#ssubmit ("value=Enviar")
			#end
			<br/>
		#end
		</div>
	</div>

	#else
		<h1> No hi ha resultats </h1>
	#end
	
	#if($msg)
		<h3> $msg </h3>
	#end
	<div id=clear></div>
	<div id=foot>
	#parse("WEB-INF/templates/pie.vm")
	</div>
</div>
</body>
</html>